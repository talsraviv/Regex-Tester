<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script src="jquery_1.6.2_min.js"></script>
    <script>

        var test_strings = [
        '2003.Warrior ',
        ' 11580',
        '(561) 789-1015',
        '5617891015',
        '561 789 1015',
        '561.789.1015',
        '+1(561) 789-1015',
        '+1 561 789 1015',
        '1 561.789-1015',
        '561|789|1015',
        '561 MOSS LEW',
        '1-800-CONTACTS',
        '1-888-MOPS-KEY',
        '1-888-KEY-MOPS',
        '1-888-K3Y-M2PS',
        '1 866 K3Y-M2PS'
        ];

        var test3 = [ 
        "8601 Adelphi Road\nCollege Park, MD\n 20740-6001",
        ];

        var test_strings2 = [
        "Los Angeles, CA\n123 Fake Street #5\n90007",
        "Los Angeles, CA\n123 Fake Street\n90007",
        "Los Angeles, CA\n90007\n123 Fake Street",
        "123 Fake Street #5\nLos Angeles, CA\n90007",
        "123 Fake Street\n90007\nLos Angeles, CA",
        "123 Fake Street, 90007, Los Angeles, CA",
        "123 Fake Street\nLos Angeles, CA\n90007",
        "8601 Adelphi Road\nCollege Park, MD\n 20740-6001",
        "PO Box 655961 Dallas, TX\n 75265-5961",
        "PO Box 4668 #37895\n New York, New York\n 10163-4668",
        "8601 Adelphi Road College Park, MD 20740-6001",
        "1515 West 2nd Ave á Vancouver, BC V6J 5C5",
        "3221 S. Cherokee Lane | Suite 1820 | Woodstock | GA | 30188",
        "9214 Tivoli Place, Boca Raton FL 33434",
        "9214 Tivoli Place, Boca Raton FL 33434",
        "777 Glades Road, Boca Raton FL 33431",
        "2 Penns Way Suite 405\n New Castle, DE 19720",
        "2 Penns Way Suite 405 New Castle, DE 19720",
        "99 West Hawthorne Avenue Suite 420\n Valley Stream NY 11580",
        "99 West Hawthorne Avenue | Suite 420 | Valley Stream NY",
        "176 B Glades Rd\n Boca Raton FL 33456",
        "176 B Glades Rd | Boca Raton FL | 33456",
        "2855 Kifer Road, Suite 105\n Santa Clara, CA 95051",
        "3711 Market St. Suite 800\n Philadelphia, PA 19104",
        "5185 Macarthur Blvd, NW #640\n Washington, DC 20016",
        "2100 Elm Street S.E.\n Minneapolis MN 55414",
        "215 Second Street Suite 300\n San Francisco, CA 94105",
        "113 Griggs Road\n Boston, MA 02446",
        "PO Box 591525\n San Francisco, CA 94159",
        "776 University Ave\n palo alto, CA 94301",
        "P.O Box 10005\n Palo Alto CA 94303",
        "3960 Howard Hughes Pkwy\n 5th Floor\n Las Vegas, NV 89169",
        "116 West Hastings Suite #200\nLas Vegas, NV 89169",
        "816 Bancroft Way\nBerkeley, CA 94710",
        "5 Technology Park Drive\n Westford, MA 01886",
        "One Johnson & Johnson Plaza\n New Brunswick, New Jersey 08933",
        "PO Box 4668 #37895\n New York, New York 10163-4668",
        "2633 Lincoln Blvd #338\n Santa Monica, CA 90405",
        "589 8th Ave Floor 11\n New York, NY 10018",
        "642 Williams Hall\n 255 S. 36th Street\n Philadelphia, PA 19104-6305",
        "19 Quaker Ridge Rd.\n Bethel CT 06801",
        "1000 Coney Island Ave.\n Brooklyn NY 11230",
        "2962 Dunedin Cv\n Germantown TN 38138",
        "1500 Vance Ave\n Memphis TN 38104",
        "915 E 7th St. Apt 6L\n Brooklyn NY 11230",
        "One Herald Square\n Boston, MA 02118",
        "1600 Amphitheatre Parkway\n Mountain View CA 94043",
        "2111 McDonald's Dr.\n Oak Brook, IL 60523",
        "1 Infinite Loop\n Cupertino, CA 95014",
        "P.O. Box 660075\n Dallas, TX 75266-0075",
        "6391 Sprint Parkway\n Overland Park KS 66251-4300",
        "PO Box 11328\n St Petersburg, FL 33733",
        "P.O. Box 920041\n Dallas, TX 75392-0041",
        "2299 Lewes-Georgetown Hwy\n Georgetown, DE 19947",
        "11522 Shawnee Road\n Greenwood DE 19950",
        "144 Kings Highway\n S.W. Dover, DE 19901",
        "33 Bridle Ridge Court\n Lewes, DE 19958",
        "2742 Pulaski Hwy\n Newark, DE 19711",
        "2284 Bryn Zion Road\n Smyrna, DE 19904",
        "1500 Serpentine Road\n Suite 100 Baltimore MD 20852",
        "580 North Dupont Highway\n Dover, DE 19901",
        "P.O. Box 778\n Dover, DE 19903",
        "123 Park Ave Apt 123\n New York City, NY 10002",
        "P.O. Box 12345\n Los Angeles, CA 12304",
        "99 West Hawthorne Avenue Suite 420, Valley Stream NY 11580",
        "99 West Hawthorne Avenue Suite 420, Valley Stream NY",
        "176 B Glades Rd, Boca Raton FL 33456",
        "2855 Kifer Road, Suite 105, Santa Clara, CA 95051",
        "3711 Market St. Suite 800, Philadelphi, PA 19104",
        "5185 Macarthur Blvd, NW #640 Washington, DC 20016",
        "2100 Elm Street S.E. Minneapolis MN 55414",
        "215 Second Street Suite 300, San Francisco, CA 94105",
        "113 Griggs Road Boston, MA 02446",
        "PO Box 591525 San Francisco, CA 94159",
        "776 University Ave á palo alto, CA 94301",
        "P.O Box 10005 Palo Alto CA 94303",
        "3960 Howard Hughes Pkwy, 5th Floor, Las Vegas, NV 89169",
        "816 Bancroft Way, Berkeley, CA 94710",
        "5 Technology Park Drive, Westford, MA 01886",
        "One Johnson & Johnson Plaza New Brunswick, New Jersey 08933",
        "PO Box 655961 Dallas, TX 75265-5961",
        "PO Box 4668 #37895 New York, New York 10163-4668",
        "2633 Lincoln Blvd, #338 Santa Monica, CA 90405",
        "589 8th Ave Floor 11, New York, NY 10018",
        "642 Williams Hall 255 S. 36th Street Philadelphia, PA 19104-6305",
        "19 Quaker Ridge Rd. Bethel CT 06801",
        "1000 Coney Island Ave. Brooklyn NY 11230",
        "2962 Dunedin Cv Germantown TN 38138",
        "1500 Vance Ave Memphis TN 38104",
        "915 E 7th St. Apt 6L Brooklyn NY 11230",
        "One Herald Square Boston, MA 02118",
        "1600 Amphitheatre Parkway Mountain View CA 94043",
        "2111 McDonald's Dr., Oak Brook, IL 60523",
        "1 Infinite Loop Cupertino, CA 95014",
        "P.O. Box 660075 Dallas, TX 75266-0075",
        "6391 Sprint Parkway Overland Park KS 66251-4300",
        "PO Box 11328 St Petersburg, FL 33733",
        "P.O. Box 920041 Dallas, TX 75392-0041",
        "2299 Lewes-Georgetown Hwy, Georgetown, DE 19947",
        "11522 Shawnee Road, Greenwood DE 19950",
        "144 Kings Highway, S.W. Dover, DE 19901",
        "33 Bridle Ridge Court, Lewes, DE 19958",
        "2742 Pulaski Hwy Newark, DE 19711",
        "2284 Bryn Zion Road, Smyrna, DE 19904",
        "1500 Serpentine Road, Suite 100 Baltimore MD 20852",
        "580 North Dupont Highway Dover, DE 19901",
        "P.O. Box 778 Dover, DE 19903",
        "123 Park Ave Apt 123 New York City, NY 10002",
        "P.O. Box 12345 Los Angeles, CA 12304",
        "32 foxes jumped over the fence",
        "I have Eight cars for you in LA",
        "I have 8 cars for you in LA",
        "One car will wait for you in LA",
        "I have 8 cars, and they are all in SF."
        ];

        $(document).ready( function() {
            $.each(test_strings, function(i, o){
                $(  '<div id=' + i + '>' +
                        '<input type="checkbox" />' +
                        '<input type="hidden" class="string" value="' + o + '" />' +
                        '<span class="wrong" style="color:red"></span>' +
                        '<span class="correct" style="color:green">' + o + '</span>' +
                        '<span class="wrong2" style="color:red"></span>' +
                    '</div>')
                .appendTo('body');
            });
            $('textarea').bind('keyup', run_regex);
            $('textarea').val( localStorage.saved_input );
            run_regex();
        });
        
        regexs = [
                /(P\.?O\.? Box\s)?(\d{1}).{0,20}\n?.{0,20}\n?.{0,20},\s(AL|AK|AZ|AR|CA|CO|CT|DE|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY|DC|FM|GU|MH|MP|PW|PR|VI|Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming|British Columbia|BC|Alberta|AB|Manitoba|MB|New Brunswick|NB|Newfoundland|NL|Northwest Territories|NT|Nova Scotia|NS|Nunavut|NU|Ontario|ON|Prince Edward Island|PE|Quebec|QC|Saskatchewan|SK|Yukon|YT)((\s|(\s.\s))((\d{5}(-\d{4})?)|(\w{3}\s\w{3})))?/g, // If just one number, like 8, then make sure there's a comma right before state abbrev (more restrictive to avoid false positives) //Also this goes first, higher priority in some test cases needs to be caught first
      
        // Base case
        /(P\.?O\.? Box\s)?(\d{2,6}).{0,20}\n?.{0,20}\n?.{0,20}\s(AL|AK|AZ|AR|CA|CO|CT|DE|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY|DC|FM|GU|MH|MP|PW|PR|VI|Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming|British Columbia|BC|Alberta|AB|Manitoba|MB|New Brunswick|NB|Newfoundland|NL|Northwest Territories|NT|Nova Scotia|NS|Nunavut|NU|Ontario|ON|Prince Edward Island|PE|Quebec|QC|Saskatchewan|SK|Yukon|YT)((\s|(\s.\s)|(\s\s))((\d{5}(-\d{4})?)|(\w{3}\s\w{3})))?/g, 

        //If One, Two, etc.. make sure there's a comma somewhere right before the state abbrev (same reason)
        /(P\.?O\.? Box\s)?(One|Two|Three|Four|Five|Six|Seven|Eight|Nine|Ten).{0,30}\n?.{0,20}\n?.{0,20},\s(AL|AK|AZ|AR|CA|CO|CT|DE|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY|DC|FM|GU|MH|MP|PW|PR|VI|Alabama|Alaska|Arizona|Arkansas|California|Colorado|Connecticut|Delaware|Florida|Georgia|Hawaii|Idaho|Illinois|Indiana|Iowa|Kansas|Kentucky|Louisiana|Maine|Maryland|Massachusetts|Michigan|Minnesota|Mississippi|Missouri|Montana|Nebraska|Nevada|New Hampshire|New Jersey|New Mexico|New York|North Carolina|North Dakota|Ohio|Oklahoma|Oregon|Pennsylvania|Rhode Island|South Carolina|South Dakota|Tennessee|Texas|Utah|Vermont|Virginia|Washington|West Virginia|Wisconsin|Wyoming|British Columbia|BC|Alberta|AB|Manitoba|MB|New Brunswick|NB|Newfoundland|NL|Northwest Territories|NT|Nova Scotia|NS|Nunavut|NU|Ontario|ON|Prince Edward Island|PE|Quebec|QC|Saskatchewan|SK|Yukon|YT)((\s|(\s.\s))((\d{5}(-\d{4})?)|(\w{3}\s\w{3})))?/g 
        
        ]

        function run_regex(e) { 

            // Only do stuff when enter is pressed - uncomment line below to enable
            //if( e && e.which !== 13) return;

            textarea = $('textarea');
            $('input[type=checkbox]').attr('checked', false);

            localStorage.saved_input = $(textarea).val();
            //console.log(localStorage.saved_input);

            var regexes = $(textarea).val().split('\n');

            // Parse regexes to find true regexes
            for(i=0; i<regexes.length; i++) {
                var curRegex = regexes[i].replace(/\n/g,' ').trim();

                // Remove lines that are pure comments
                comment = curRegex.match(/\/\/.+/g);
                if(comment && comment[0]===curRegex) {
                    regexes[i] = "";
                    continue;
                }

                // Remove comments at the end of lines
                if(comment) {
                    commentStart = curRegex.indexOf(comment[0]);
                    if(commentStart != -1) {
                        curRegex = curRegex.substr(0,commentStart).trim();
                    }
                }
                
                // Remove comma if in array
                if(curRegex.charAt(curRegex.length-1)===',') {
                    curRegex = curRegex.substr(0,curRegex.length-1);
                }

                // Remove 'g' if its there
                if(curRegex.charAt(curRegex.length-1)==='g') {
                    curRegex = curRegex.substr(0,curRegex.length-1);
                }

                // Remove delimiters
                curRegex = curRegex.substr(1,curRegex.length-2);

                regexes[i] = curRegex;
            }

            // Get rid of invalid regexes (just empty strings) 
            var emptyIndex;
            while(true) {
                emptyIndex = regexes.indexOf(""); 
                if(emptyIndex === -1 ) break;
                regexes.splice(emptyIndex,1);
            }
            
            // Set number of regexes
            $('#numRegexes').text( regexes.length);

            
            // Test each string
            $('.string').each( function(i, spanString) {

                // Set up fields
                var correct = $(this).siblings('.correct');
                var wrong = $(this).siblings('.wrong');
                var wrong2 = $(this).siblings('.wrong2');
                $(correct).text( '' );
                $(wrong).text( '' );
                $(wrong2).text( '' );
                
                var stringToMatch = $(this).val();

                // That is the parent DOM element for each string to test 
                var that = this;

                // Use all regexes
                for(j=0; j<regexes.length; j++) {
                    regexString = regexes[j];            

                    var regex = new RegExp(regexString,'g');
                    var match = stringToMatch.match(regex);

                    // If there is a match, just check the box and dont check
                    // any more regexes.
                    if (match && match[0] === stringToMatch) {
                        $(correct).text( stringToMatch.replace(/\n/g,'*') );
                        $(wrong).text( '' );
                        $(wrong2).text( '' );
                        $(that).siblings('input[type=checkbox]').attr('checked', 'true');
                        break;
                       
                    // Else find what went wrong and highlight the bad parts   
                    } else {

                        var original = stringToMatch.replace(/\n/g,'*');
                        var match = (match ? match[0].replace(/\n/g,'*') : "");
                        $(correct).text(match);

                        var matchStart = original.indexOf(match);
                        var matchEnd = matchStart + match.length;
                        var matchLength = matchEnd - matchStart;
                        var nonMatchLength = original.length-match.length;
                        var nonMatch;

                        // Errors we're either in the beginning or the end
                        if(matchStart!=0) {
                            nonMatch = original.substr( 0, nonMatchLength);
                            $(wrong).text( nonMatch );
                        } else {
                            nonMatch = original.substr( matchLength, nonMatchLength);
                            $(wrong2).text( nonMatch );
                        }

                        //console.log(match);
                        //console.log(nonMatch);
                    }
                }
            });

            // Update success rate
            $('#count').text($('input[checked=checked]').length);
            $('#total').text($('input[type=checkbox]').length);
        }

    </script>
</head>
<body>

    <textarea rows="10" cols="90">

    </textarea>

    <div>
        <p>Testing <span id="numRegexes"></span> regular expressions
        <p>Total correct: <span id="count"></span> out of <span id="total"></span>
    </div>

</body>

</html>
